# Micro-Frontend-Architecture_Study

-   MFA, 모노레포, 모듈페더레이션 등을 배워봅시다!

## Micro Frontends 개념 기초 학습

### Monolith

-   Frontend와 Backend, Database에 이르기까지 하나의 팀에서 하나의 프로그램을 함께 만들고, 수정하고 배포하게 됩니다.
-   단점으로는 HTML, API 등을 수정해도 적용하려면 전체를 다시 배포해야함
-   보통 MVP를 빠르게 만들고 사업성을 증명해야할 필요가 있을때 이것을 채용함

### Frontend & Backend

-   더 많은 사람들이 많은 일을 동시에 할 수 있도록, 즉 개발 효율성을 향상시키기 위해서 팀을 분리함
-   팀 간에는 API라는 인터페이스를 기반으로 소통하게 됩니다.

### Frontend & Micro Service Backend

-   백엔드에서 서비스를 더 전문적으로 만들고 고도화 시킬 목적으로 마이크로 서비스를 도입
-   백엔드 API들과 프론트엔드 사이의 비효율성을 개선하기 위해 BFF와 GraphQL이 이때 유행하기 시작함

### Micro Frontends

-   독립적으로 제공 가능한 프론트엔드 애플리케이션이 더 큰 전체로 구성되는 아키텍쳐 스타일
-   MSA(Micro Service Architecture)에서 시작된 Architecture임
-   MSA의 경우 백엔드에서 주로 사용하고 필수 아키텍쳐로 채용되어 있을만큼 유명함

### Monolith Frontend 와 Micro Frontends의 비교

| 비교군            | Monolith Frontend        | Micro Frontends |
| ----------------- | ------------------------ | --------------- |
| 초기 개발 속도    | 빠르다                   | 느리다          |
| 빌드 / 배포 설정  | 단순                     | 복잡            |
| 개발 환경 설정    | 간단                     | 복잡            |
| 커뮤니케이션 비용 | 시스템이 커질수록 커진다 | 작다            |
| 배포 시간         | 느리다                   | 빠르다          |
| 장애 파급 범위    | 크다                     | 작다            |
| 자율성            | 낮다                     | 높다            |

### Micro Frontends 도입 검토 시기

-   프로젝트 규모가 커야함
    -   프로젝트 규모가 크다는 것은
        -   코드의 양이 많아서 크다.
            -   코드가 10만줄 이상이면 도입 고민
        -   팀원이 많다.
            -   프론트엔드 엔지니어가 5인 이상이면 고민
        -   제공하는 기능이 많다.
            -   서비스 페이지가 100페이지 이상이면 고민
            -   제공하는 기능이 50가지 이상이면 고민
    -   규모가 커지면서 Monolith Frontend 시스템에서 나타나는 전조 증상
        -   코드를 수정한 후, 엉뚱한 곳에서 버그가 발생함
        -   새로운 기능을 위해 기존 코드를 활용하기 무서움
        -   간단한 수정 사항을 적용하기 위해 통합, 테스트, 빌드 및 배포 시간이 점점 길어짐
        -   작업을 위한 커뮤니케이션이 점점 늘어남
        -   동일한 기능을 제공하기 위해 여기 저기서 각각 개발하는 일이 늘어난다.

### Micro Frontends 도입의 장점

-   덜 복잡하고, 적은 양의 코드를 관리하여 코드의 품질을 높일 수 있습니다.
-   배포의 범위가 줄어들어 빌드 및 배포 시간이 줄고 위험도가 줄어듭니다.
-   단일 장애 지점 (Single Point Of Failure) 을 피할 수 있습니다.
-   점진적으로 업그레이드 하기에 용이합니다.
-   요구사항에 맞춰 애플리케이션을 자유롭게 조립하여 제공할 수 있습니다.
-   독립적으로 개발 및 배포할 수 있기 때문에 오너십을 가진 팀이 자유롭게 스케줄을 조정할 수 있습니다.
-   팀이 주도적으로 자유롭게 기술 스택을 선택할 수 있습니다.
-   서로 다른 팀이 독립적으로 작업을 할 수 있기 때문에 개발 주기가 더 빨라질 수 있습니다.

### Micro Frontends 도입의 단점

-   중복 코드가 발생할 수 있다.
-   전체적인 리소스의 크기가 커져 성능 저하에 대한 주의가 필요하다.
-   초기 구축 비용이 발생한다.
-   다양한 마이크로 프론트엔드 간의 통합과 통신에서 추가적인 복잡성이 발생할 수 있다.
-   빌드 타임에서는 문제가 발생하지 않지만, 런타임에 동적으로 통합하는 과정에서 문제가 발생할 수 있다.
-   각각 자율적으로 발전하는 마이크로 프론트엔드 간의 일관적인 UX 제공을 위한 장치가 필요하다.
-   마이크로 프론트엔드마다 기술적인 격차가 벌어질 가능성이 있다.

### Micro Frontends 도입이 필요한 경우

-   적절한 규모의 팀을 벗어난 경우

    -   소수의 개발자만 있고 의사 소통에 문제가 없는 경우, 마이크로 프론트엔드가 주는 이점보다는 비용이 더 크다.
    -   마이크로 앱으로 분해하여 각 팀마다 개발할 인원이 충분한 경우
        -   프론트엔드 개발자가 많은 경우
        -   크로스 펑셔널 팀을 조직 가능한 경우

-   기능적으로 마이크로 앱으로 분해가 가능한 경우

    -   서비스가 URL 경로를 기준으로 기능적으로 구분이 가능한 경우
    -   어떤 팀이 어떤 부분에 책임을 가지고 있는지가 명확하게 구분이 가능해야함
        -   불분명하거나 중복된 부분이 발생하지 않아야함

-   런타임에 여러가지 마이크로 앱을 선택적으로 조립해서 제공해야 하는 경우

    -   런타임에 특정 버전을 사용하도록 처리 할 수 있음

-   마이크로 앱이 독립적으로 인프라 구성이 가능한 경우
    -   클라우드 자원을 충분히 활용 가능한 경우
    -   같은 서버에 서로 다른 마이크로 앱을 배포하는 경우 의미가 적어짐

### 서비스를 어떻게 나눠야 할까요?

-   페이지의 구조를 통해 나누는 방법

    -   모든 페이지의 경로를 리스트업하고, 적절한 팀에게 나눠준다.
    -   이미 서비스가 있는 경우에 좀 더 유용할 수 있다.
    -   일부 페이지에는 둘 이상의 목적이 있을 수 있고 그러면 잘라내서 적당한 팀에게 줍니다.
        -   이 부분이 공유 코드 조각이 될 가능성이 있습니다.

-   고객 요구 사항을 중심으로 나누는 방법
-   도메인 주도 설계를 통해 나누는 방법

    -   도메인 기반 설계는 소프트웨어 구조화에 널리 사용되는 접근 방식입니다. 특정 규모의 프로젝트
        에 대해 일관된 모델을 만드는 것이 어렵다는 사실을 인정하고, 서로 명시적인 관계가 있는 더 작
        은 하위 모델을 만들어 이러한 복잡성을 처리하는 패턴을 제공합니다.

    -   DDD 는 프로젝트의 영역을 식별하고 격리하기 위한 일련의 개념과 도구를 제공합니다. 회사의
        다양한 전문가와 부서의 언어를 분석한다는 아이디어, 즉 유비쿼터스 언어를 소개합니다.

    -   어휘의 차이점을 분석하여, DDD 의 핵심 개념 중 하나인 bounded contexts 를 식별할 수 있습니다. bounded contexts 는 서로 관련된 비즈니스 프로세스 그룹으로 볼 수 있습니다. 체크아웃 프로세스는 bounded contexts 로 볼 수 있습니다. 그것은 서로 밀접하게 관련된 배송 및 지불과 같은 다양한 하위 주제로 구성됩니다.

    -   기존에 마이크로서비스 아키텍처가 견고하게 구성되어 있는 경우, 마이크로서비스의 도메인 모델로부터 도움을 받을 수 있습니다.

    -   하지만, 마이크로서비스의 도메인은 UI 로 드러나지 않는 경우도 있기 때문에 어려움이 있을 수 있습니다.

### Micro Frontends 와 Monorepo

-   Monolith Repo

    -   한 저장소에 하나의 앱에 관련된 모든 코드와 리소스를 넣는 방식
    -   프로젝트 하나(React SPA or NestJS 등등)
    -   프로젝트 하나 안에 페이지들, UI 컴포넌트들, 상태 관리 로직 및 데이터 처리 등 모든 것이 들어 있습니다.
    -   Monorepo ≠ Monolith

-   Modular Repo

    -   소스 코드를 분류하여 여러개의 모듈로 나누고 모듈을 각각의 패키지로 만들어 패키지간 필요한 패키지를 가져다 쓰는 방식
    -   패키지간 잘 정의된 관계가 없다면 Monorepo가 아님
    -   이러한 패키지 간 잘 정의된 관계로 여러 패키지를 하나의 레포에서 관리하는 방식이 Monorepo이다.

-   Monorepo 와 Polyrepo

    -   "모듈로 나누어 연관 짓는다"라는 개념 아래서 하나의 Repo로 관리하면 Monorepo, 모듈마다 Repo를 가지고 관리하면 Polyrepo 혹은 Multirepo라고 한다.
    -   Polyrepo에서의 단점 = Monorepo에서의 장점
        -   이슈 수정을 하다가 라이브러리를 수정해야 해서 번거로운 일이 발생한다.
        -   히스토리가 한번에 보이지 않는다.
        -   기존 코드를 활용하려면 추가적인 비용이 든다.
        -   프로젝트를 새로 생성할 때, 비용이 크다.
        -   각 프로젝트마다 설정이 일관적이지 않아 컨텍스트 스위칭과 유지보수 맥락이 끊긴다.
    -   Monorepo에서의 단점 = Polyrepo에서의 장점
        -   상대적으로 의존성 연결이 쉽기 때문에 과도한 의존 관계가 나타날 수 있다.
        -   하나의 CI를 구성할 수는 있지만, 방법이 복잡할 수 있다.
        -   저장소 자체가 빠르게 무거워진다.
        -   모든 코드가 밀집되어있어 사소한 문제가 크게 확대될 가능성이 있다.

-   Monorepo는 결국 잘 정의된 관계를 가진 여러 개의 개별 프로젝트가 포함된 단일 레포지토리이다.

-   Micro Frontends에 Monorepo가 꼭 필요한가?

    -   꼭 필요한것은 아니다.
    -   먼저 여러개의 프로젝트(마이크로 앱)가 모여 하나의 앱을 만들기 때문에 프로젝트는 여러개가 필요하다.
    -   프로젝트들이 잘 정의된 관계를 가지고 있다.
        -   공통으로 쓰는 코드들을 따로 빼서 함께 사용한다
        -   이러한 패키지들이 의존 관계를 명확히 가지고 있어야 한다.
        -   수정된 패키지가 어떤 마이크로 앱들에게 영향을 주는지 확실히 알아야 한다.
            -   이것이 배포의 범위를 결정
    -   이슈 수정을 하다가 라이브러리를 수정해야해서 번거로운 일이 발생하지 않는다.
        -   이슈 기반의 커밋을 하게 된다.
    -   전체 히스토리가 한번에 보인다.
    -   기존 코드를 활용할 때 드는 비용이 작다.
    -   프로젝트를 새로 생성할 때, 비용이 작다.
    -   각 프로젝트마다 설정이 일관적이고 같안 DX를 가질 수 있다.
    -   상대적으로 의존성 연결이 쉽기 때문에 과도한 의존 관계가 나타나지 않도록 주의해야 한다.
    -   방법이 복잡할 수 있지만 함께 하나의 CI를 구성할 수는 있고 일관적인 DX를 발전시킬 수 있다.
    -   Monorepo Tool을 이용해서 성능에 주의를 기울입니다.
    -   모든 코드가 밀집되어 있어 사소한 문제가 크게 확대될 가능성이 있음에 주의하고 여러군데서 사용하는 코드에 대해 여러 프로젝트 담당자들과 함께 충분히 검증한다.

### Monorepo 도입 여부 결정 및 구현 방식 결정

-   Package Manager Workspaces를 이용하여 구현할 수 있다.
-   Monorepo Tool의 필요성.
    -   그냥 Package Manager Workspaces 기능만 활용하면 안될까?
        -   개발 과정에서 여러 패키지들을 사용하고 패키지는 그냥 코드를 바로 사용하는 방식이 아니라 빌드 과정이 필요하기 때문에 속도에 대한 문제가 발생할 수 있고, 예민한 문제이다.
    -   레포지토리 내 워크스페이스에 대한 분석과 시각화 기능을 활용하면 전체를 파악할 때 효과적입니다.
    -   스케폴딩이나 코드 공유 그리고 사용 제한 등의 관리에 수작업이 아니라 도구를 제공하면, 좀 더 편리하다.
    -   Monorepo Tool을 살펴보면 어떤 기능이 있는지 보면 역으로 유용한 기능이 있음을 알 수 있다.
        https://monorepo.tools/

### 통합 방법 설계 및 적절 기술 스택과 도구 선택

-   Server-side template composition
-   Build-time integration
-   Run-time integration via iframes
-   Run-time integration via Web Components
-   Run-time integration via JavaScript
-   Run-time integration via Module Federation
-   Linked SPA & Unified SPA

### 공통 모듈 설계 및 인터페이스 결정

-   재사용 가능한 컴포넌트
-   공통 설정 혹은 유틸리티
-   인프라 레벨의 코드(HTTP Client Wrapper)

### Micro Frontends 와 디자인 시스템

-   디자인 시스템이란?

    -   디자인 시스템은 명확한 표준에 따라 재사용 가능한 구성 요소의 모음으로, 여러 앱을 구축하기 위해 함께 조립할 수 있다.
    -   디자인 시스템은 앱이나 웹사이트와 같은 디지털 제품 설계 및 제품 개발에 도움이 된다.
    -   디자인 시스템에는 패턴 라이브러리, 디자인 언어, 스타일 가이드, 코딩된 구성 요소, 브랜드 언어 및 문서가 포함될 수 있지만 이에 국한되지는 않는다.
    -   디자이너, 개발자, 카피라이터, 프로젝트 관리자 등 다양한 관련 팀이 디지털 제품을 디자인하고 구축하는데 도움이 되는 참고 자료로 사용된다.

-   디자인 시스템 장점

    -   디자인부터 프로덕션 워크플로우까지 간소화
    -   교차 가능 팀 간 및 팀 내에서 통합된 언어 생성
    -   재사용 가능한 컴포넌트와 공유된 논리적 근거를 통해 제작 속도 향상
    -   더욱 응집력 있는 사용자 경험과 일관된 디자인 언어를 통해 더 나은 제품을 제공합니다.
    -   설계 및 기술 부채 감소를 통한 유지 관리 및 확장성 개선
    -   공통된 문제를 해결하여 팀이 사용자 요구 사항을 해결하는데 집중할 수 있으므로 제품팀의 집중력 향상

-   디자인 시스템 레포지토리

    -   Style Guide
        -   스타일 가이드에는 인터페이스 또는 기타 디자인 결과물을 만들기 위한 구체적인 구현 지침, 시작적 레퍼런스 및 디자인 원칙이 포함되어 있습니다.
    -   Component Library
        -   재사용 가능한 UI 요소가 포함되어 있으며 디자이너와 개발자 모두 특정 UI 요소에 대해 배우고 구현할 수 있는 원본의 역할을 합니다.
    -   Pattern Library
        -   UI 요소 그룹 또는 레이아웃의 컬렉션을 제공합니다.
        -   일반적으로 콘텐츠 구조, 레이아웃 또는 템플릿을 포함합니다.
        -   컴포넌트와 마찬가지로 패턴은 재사용하고 조정할 수 있습니다.

-   Micro Frontends 와 디자인 시스템의 관계
    -   Micro Frontends는 하나의 앱이다.
    -   하나의 앱인데 서로 다른 서비스처럼 보이면 완성도가 떨어져 고객의 신뢰가 떨어질 수 있다.
    -   여러 End-to-End 팀들이 각자 작업을 하다보면 파편화가 발생할 수 있고, 생산성에도 문제가 생길 수 있다.
    -   디자인과 개발의 Single Source of Truth가 필요하고, 디자인 원칙과 재사용 가능한 컴포넌트의 관리가 필수적입니다.
    -   디자인 시스템은 일반적으로 관리를 하는 만큼 강력한 힘을 가지게 됩니다.
